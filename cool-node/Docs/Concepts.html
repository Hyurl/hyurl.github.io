<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Docs: Concepts | Cool-Node</title>
    <link rel="stylesheet" href="/cool-node/css/highlightjs-theme/monokai.css" />
    <link rel="stylesheet" href="/cool-node/css/vivify.min.css">
    <link rel="stylesheet" href="/cool-node/css/style.css">
</head>

<body>
    <header class="header vivify popInTop">
        <div class="logo">
            <a href="/cool-node/">Cool-Node</a>
        </div>
        <div class="change-lang">
            <a href="?lang=zh">中文</a>
        </div>
        <div class="navbar">
            <ul>
                <li><a href="/cool-node/">Home</a></li>
                <li><a href="/cool-node/cool-node/Docs">Docs</a></li>
            </ul>
        </div>
        <div class="navbar-toggle">
            <button>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
        </div>
    </header>
    <div class="github-brand vivify fadeIn">
        <a href="https://github.com/Hyurl/cool-node" target="_blank" class="btn btn-default">
            <svg aria-hidden="true" class="octicon octicon-mark-github" version="1.1" viewBox="0 0 16 16" style="width:16px;height:16px;margin-bottom:-3px;">
                <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path>
            </svg> Fork Me on GitHub
        </a>
    </div>
    <div class="container vivify fadeIn">
        <aside class="sidebar vivify fadeIn">
            <ul>
                <li><a href="/cool-node/Docs/GettingStarted">Getting Started</a></li>
                <li>
                    <a href="javascript:;">The Basics</a>
                    <ul>
                        <li><a href="/cool-node/Docs/Concepts">Concepts</a></li>
                        <li><a href="/cool-node/Docs/WritingHttpControllers">Writing HTTP Controllers</a></li>
                        <li><a href="/cool-node/Docs/WritingSocketControllers">Writing Socket Controllers</a></li>
                        <li><a href="/cool-node/Docs/DesigningViews">Designing Views</a></li>
                    </ul>
                </li>
                <li><a href="/cool-node/Docs/Modelar">Modelar ORM</a></li>
                <li><a href="/cool-node/Docs/Mail">Sending E-Mail</a></li>
                <li><a href="/cool-node/Docs/More">More</a></li>
                <li><a href="/cool-node/Docs/MigrationGuide">Migration Guide</a></li>
            </ul>
        </aside>
        <article class="content vivify fadeIn">
            <h2 id="Project-Structure">
                <a class="heading-anchor" href="#Project-Structure">
                    <svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16">
                        <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
                    </svg>
                </a>Project Structure
            </h2>
            <p>A typical Cool-Node project has a structure like this:</p>
            <pre style="background: #ddd;padding: 10px;color: #333;font-size: 14px;">
/ --------------------- Indicates the root directory of the project.
|-- App/ -------------- Contains files of an App.
|   |-- Assets/ ------- Contains files which can be directly accessed from 
|   |                   clients, like css, js, etc.
|   |-- Controllers/ -- Contains all controller files.
|   |   |-- Home.js --- A controller that listens to the root path of the URL.
|   |
|   |-- Models/ ------- Contains all model files.
|   |-- Views/ -------- Contains all view files.
|
|-- Core/ ------------- Contains all Cool-Node core files (do not modify),
|                       This folder has been removed since 1.2.0.
|
|-- Middleware/ -------- Contains all middleware files.
|   |-- http/ ---------- A folder contains HTTP middleware files.
|   |-- socket/ -------- A folder contains socket middleware files.
|
|-- node_modules/ ------ All node modules are stored here.
|
|-- config.js ---------- Configurations of the project.
|-- index.js ----------- Entry file of the program.
|-- package.json ------- A file manages the project and dependencies.
            </pre>

            <p>
                This tutorial is based on Node.js 6.0+, which is not yet support all features of ECMAScript 2015, so if you want to learn about something like <code>async</code>,
                <code>await</code> or <code>import</code>, you may want to learn them on
                <a href="https://developer.mozilla.org">MDN</a> yourself.
            </p>
            <h2 id="Reserved-Properties">
                <a class="heading-anchor" href="#Reserved-Properties">
                    <svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16">
                        <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
                    </svg>
                </a>Reserved Properties
            </h2>
            <p>In a Cool-Node project, there are several properties reserved, you can use them, but <strong>DO NOT</strong> try to reassign them.</p>
            <ul>
                <li><code>global.ROOT</code> A path string indicates the project root directory.</li>
                <li><code>global.config</code> Configurations of the project.</li>
                <li><code>global.wsServer</code> WebSocket server listens <code>ws</code> protocol <em>(Since 1.1.0)</em>.</li>
                <li><code>global.wssServer</code> WebSocket server listens <code>wss</code> protocol <em>(Since 1.1.0)</em>.</li>
                <li><code>req.session</code> The session of the current request.</li>
                <li><code>req.subdomain</code> The subdomain of the current request.</li>
                <li><code>req.db</code> A database instance from the Modelar ORM.</li>
                <li><code>socket.session</code> The session of the current socket.</li>
                <li><code>socket.subdomain</code> The subdomain of the current socket.</li>
                <li><code>socket.db</code> A database instance from the Modelar ORM.</li>
            </ul>
            <p>You can see other <code>req</code> properties in the Node.js API documentation at
                <a href="https://nodejs.org">nodejs.org</a> and the Express API documentation at
                <a href="http://expressjs.com/">expressjs.com</a>, and other <code>socket</code> properties in Socket.io API documentation at <a href="https://socket.io/">socket.io</a>.</p>
            <p>Also, there are some reserved properties in the project, they will mean something if you assign values to them.</p>
            <ul>
                <li><code>req.session.UID</code> The authorized user ID of the current request.</li>
                <li><code>req.user</code> The authorized user of the current request. If you have assigned
                    <strong>req.session.UID</strong>, this property will be automatically assigned.</li>
                <li><code>socket.session.UID</code> The authorized user ID of the current socket peer.</li>
                <li><code>socket.user</code> The authorized user of the current socket peer. If you have assigned <strong>socket.session.UID</strong>, this property will be automatically assigned.
                </li>
            </ul>
            <h3 id="More-Details-about-Sessions-and-Database-Connections">
                <a class="heading-anchor" href="#More-Details-about-Sessions-and-Database-Connections">
                    <svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16">
                        <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
                    </svg>
                </a>More Details about Sessions and Database Connections
            </h3>
            <p>
                Another tip for sessions, since Cool-Node is a cross-protocol program, the session in a HTTP request is actually the session in a corresponding socket. So when you assigning a property to the session object, whether from HTTP or socket, the other one
                will also be affected. Meaning, when you logged-in from a HTTP request, the socket will be logged-in as well, and vise versa.
            </p>
            <p>
                And since <code>req.user</code> is only available in the current request, you should always assign <code>req.session.UID</code> instead, if you are using session to recognize the user. But if you are using other techniques like access
                token, then you should assign <code>req.user</code> and <code>socket.user</code> in a middleware instead.
            </p>
            <p>
                Don&#39;t worry that when you call <code>req.db</code> or <code>socket.db</code>, a new database connection will be created, it won&#39;t. Modelar ORM handle database connections very efficient, connections won&#39;t be established until
                you explicitly calling
                <code>db.connect()</code> of implicitly created by executing a query.
            </p>
            <p>
                Since version 1.1.0, <code>req.db</code> and <code>socket.db</code> can be reassigned or pre-defined, if you don&#39;t assign a value to them, then a default value will be used when accessing them.
            </p>
            <p>
                Also, all connections will be recycled to a internal pool and wait for the next time acquiring after a HTTP response or a socket message is sent.
            </p>
        </article>
    </div>

    <footer>
        <p class="text-center">
            <span id="copyright">©2017
                <a href="https://hyurl.github.io/cool-node/">Cool Node</a> <a href="https://github.com/Hyurl/cool-node/blob/master/update-log.md">1.2.4</a> based on
                <a href="http://nodejs.org/">Node.js</a> 6.0+.
            </span>
            <span id="license">Licensed under the
                <a target="_blank" href="http://spdx.org/licenses/MIT.html">MIT License</a>.
            </span>
            <span id="icp">
                <a href="http://www.miitbeian.gov.cn" target="_blank" style="color:#777">桂ICP备15001693号</a>
            </span>
        </p>
        <p class="text-center">See Other Projects:
            <a href="http://modelar.hyurl.com/">Modelar</a> |
            <a href="http://modphp.hyurl.com/">ModPHP</a> |
            <a href="http://modphp.hyurl.com/ModCMS/">ModCMS</a> |
            <a href="https://github.com/hyurl/type-storage">TypeStorage</a>
        </p>
    </footer>

    <script src="/cool-node/js/jquery.min.js"></script>
    <script src="/cool-node/js/soft-loader.js"></script>
    <script src="/cool-node/js/javascript.js"></script>
</body>

</html>